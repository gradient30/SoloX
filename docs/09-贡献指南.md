# è´¡çŒ®æŒ‡å—

## ğŸ¤ æ¬¢è¿è´¡çŒ®

æ„Ÿè°¢æ‚¨å¯¹ SoloX é¡¹ç›®çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

- ğŸ› Bug æŠ¥å‘Šå’Œä¿®å¤
- âœ¨ æ–°åŠŸèƒ½å¼€å‘
- ğŸ“š æ–‡æ¡£æ”¹è¿›
- ğŸ§ª æµ‹è¯•ç”¨ä¾‹ç¼–å†™
- ğŸŒ å›½é™…åŒ–æ”¯æŒ
- ğŸ’¡ åŠŸèƒ½å»ºè®®

## ğŸ“‹ è´¡çŒ®æµç¨‹

### 1. å‡†å¤‡å·¥ä½œ

```bash
# 1. Fork é¡¹ç›®åˆ°æ‚¨çš„ GitHub è´¦æˆ·
# 2. å…‹éš†æ‚¨çš„ Fork
git clone https://github.com/YOUR_USERNAME/SoloX.git
cd SoloX

# 3. æ·»åŠ ä¸Šæ¸¸ä»“åº“
git remote add upstream https://github.com/smart-test-ti/SoloX.git

# 4. åˆ›å»ºå¼€å‘ç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate  # Windows

# 5. å®‰è£…å¼€å‘ä¾èµ–
pip install -e .
pip install pytest pytest-cov black flake8 mypy
```

### 2. å¼€å‘æµç¨‹

```bash
# 1. åŒæ­¥æœ€æ–°ä»£ç 
git fetch upstream
git checkout main
git merge upstream/main

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/your-feature-name
# æˆ–
git checkout -b fix/your-bug-fix

# 3. è¿›è¡Œå¼€å‘
# ç¼–å†™ä»£ç ã€æµ‹è¯•ã€æ–‡æ¡£

# 4. æäº¤ä»£ç 
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½æè¿°"

# 5. æ¨é€åˆ°æ‚¨çš„ Fork
git push origin feature/your-feature-name

# 6. åˆ›å»º Pull Request
# åœ¨ GitHub ä¸Šåˆ›å»º PR
```

## ğŸ“ ä»£ç è§„èŒƒ

### 1. Python ä»£ç é£æ ¼

æˆ‘ä»¬ä½¿ç”¨ [Black](https://black.readthedocs.io/) è¿›è¡Œä»£ç æ ¼å¼åŒ–ï¼š

```bash
# æ ¼å¼åŒ–ä»£ç 
black solox/

# æ£€æŸ¥ä»£ç é£æ ¼
flake8 solox/

# ç±»å‹æ£€æŸ¥
mypy solox/
```

**ä»£ç é£æ ¼è¦æ±‚**:
- ä½¿ç”¨ 4 ä¸ªç©ºæ ¼ç¼©è¿›
- è¡Œé•¿åº¦é™åˆ¶ä¸º 88 å­—ç¬¦
- ä½¿ç”¨ç±»å‹æ³¨è§£
- éµå¾ª PEP 8 è§„èŒƒ

### 2. æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨ [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

```bash
# åŠŸèƒ½æ·»åŠ 
git commit -m "feat: æ·»åŠ  iOS è®¾å¤‡æ¸©åº¦ç›‘æ§åŠŸèƒ½"

# Bug ä¿®å¤
git commit -m "fix: ä¿®å¤ Android å†…å­˜æ•°æ®è·å–å¼‚å¸¸"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: æ›´æ–° API ä½¿ç”¨æ–‡æ¡£"

# æµ‹è¯•æ·»åŠ 
git commit -m "test: æ·»åŠ  CPU ç›‘æ§å•å…ƒæµ‹è¯•"

# é‡æ„
git commit -m "refactor: é‡æ„è®¾å¤‡ç®¡ç†æ¨¡å—"

# æ€§èƒ½ä¼˜åŒ–
git commit -m "perf: ä¼˜åŒ–å†…å­˜æ•°æ®æ”¶é›†æ€§èƒ½"

# æ„å»ºç›¸å…³
git commit -m "build: æ›´æ–°ä¾èµ–åŒ…ç‰ˆæœ¬"

# CI/CD
git commit -m "ci: æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹"
```

### 3. ä»£ç ç¤ºä¾‹

```python
from typing import Optional, Dict, Any
import logging

logger = logging.getLogger(__name__)

class PerformanceMonitor:
    """æ€§èƒ½ç›‘æ§åŸºç±»
    
    Args:
        device_id: è®¾å¤‡ ID
        package_name: åº”ç”¨åŒ…å
        platform: å¹³å°ç±»å‹ ('Android' æˆ– 'iOS')
    
    Example:
        >>> monitor = PerformanceMonitor('device123', 'com.example.app', 'Android')
        >>> cpu_data = monitor.collect_cpu()
        >>> print(f"CPU ä½¿ç”¨ç‡: {cpu_data['app_cpu']}%")
    """
    
    def __init__(
        self, 
        device_id: str, 
        package_name: str, 
        platform: str
    ) -> None:
        self.device_id = device_id
        self.package_name = package_name
        self.platform = platform
        self._validate_parameters()
    
    def _validate_parameters(self) -> None:
        """éªŒè¯åˆå§‹åŒ–å‚æ•°"""
        if not self.device_id:
            raise ValueError("device_id ä¸èƒ½ä¸ºç©º")
        
        if not self.package_name:
            raise ValueError("package_name ä¸èƒ½ä¸ºç©º")
        
        if self.platform not in ['Android', 'iOS']:
            raise ValueError("platform å¿…é¡»æ˜¯ 'Android' æˆ– 'iOS'")
    
    def collect_cpu(self) -> Dict[str, float]:
        """æ”¶é›† CPU ä½¿ç”¨ç‡æ•°æ®
        
        Returns:
            åŒ…å« app_cpu å’Œ sys_cpu çš„å­—å…¸
            
        Raises:
            RuntimeError: å½“æ•°æ®æ”¶é›†å¤±è´¥æ—¶
        """
        try:
            if self.platform == 'Android':
                return self._collect_android_cpu()
            else:
                return self._collect_ios_cpu()
        except Exception as e:
            logger.error(f"CPU æ•°æ®æ”¶é›†å¤±è´¥: {e}")
            raise RuntimeError(f"CPU æ•°æ®æ”¶é›†å¤±è´¥: {e}")
    
    def _collect_android_cpu(self) -> Dict[str, float]:
        """æ”¶é›† Android CPU æ•°æ®"""
        # å®ç° Android CPU æ•°æ®æ”¶é›†
        pass
    
    def _collect_ios_cpu(self) -> Dict[str, float]:
        """æ”¶é›† iOS CPU æ•°æ®"""
        # å®ç° iOS CPU æ•°æ®æ”¶é›†
        pass
```

## ğŸ§ª æµ‹è¯•è¦æ±‚

### 1. å•å…ƒæµ‹è¯•

```python
# tests/test_performance_monitor.py
import unittest
from unittest.mock import patch, MagicMock
from solox.public.apm import PerformanceMonitor

class TestPerformanceMonitor(unittest.TestCase):
    
    def setUp(self):
        """æµ‹è¯•å‰å‡†å¤‡"""
        self.monitor = PerformanceMonitor(
            device_id='test_device',
            package_name='com.test.app',
            platform='Android'
        )
    
    def test_init_valid_parameters(self):
        """æµ‹è¯•æœ‰æ•ˆå‚æ•°åˆå§‹åŒ–"""
        self.assertEqual(self.monitor.device_id, 'test_device')
        self.assertEqual(self.monitor.package_name, 'com.test.app')
        self.assertEqual(self.monitor.platform, 'Android')
    
    def test_init_invalid_platform(self):
        """æµ‹è¯•æ— æ•ˆå¹³å°å‚æ•°"""
        with self.assertRaises(ValueError):
            PerformanceMonitor('device', 'app', 'InvalidPlatform')
    
    @patch('solox.public.apm.PerformanceMonitor._collect_android_cpu')
    def test_collect_cpu_android(self, mock_collect):
        """æµ‹è¯• Android CPU æ•°æ®æ”¶é›†"""
        # æ¨¡æ‹Ÿè¿”å›æ•°æ®
        mock_collect.return_value = {'app_cpu': 25.5, 'sys_cpu': 45.2}
        
        result = self.monitor.collect_cpu()
        
        self.assertEqual(result['app_cpu'], 25.5)
        self.assertEqual(result['sys_cpu'], 45.2)
        mock_collect.assert_called_once()
    
    def test_collect_cpu_exception_handling(self):
        """æµ‹è¯•å¼‚å¸¸å¤„ç†"""
        with patch.object(self.monitor, '_collect_android_cpu', 
                         side_effect=Exception("Test error")):
            with self.assertRaises(RuntimeError):
                self.monitor.collect_cpu()

if __name__ == '__main__':
    unittest.main()
```

### 2. é›†æˆæµ‹è¯•

```python
# tests/test_integration.py
import unittest
import requests
import time
from solox.web import main
import multiprocessing

class TestAPIIntegration(unittest.TestCase):
    
    @classmethod
    def setUpClass(cls):
        """å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨"""
        cls.server_process = multiprocessing.Process(
            target=main, 
            args=('127.0.0.1', 50004)
        )
        cls.server_process.start()
        time.sleep(2)  # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
        cls.base_url = 'http://127.0.0.1:50004'
    
    @classmethod
    def tearDownClass(cls):
        """å…³é—­æµ‹è¯•æœåŠ¡å™¨"""
        cls.server_process.terminate()
        cls.server_process.join()
    
    def test_health_endpoint(self):
        """æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹"""
        response = requests.get(f'{self.base_url}/health')
        self.assertEqual(response.status_code, 200)
        
        data = response.json()
        self.assertIn('status', data)
        self.assertEqual(data['status'], 'ok')
    
    def test_collect_api(self):
        """æµ‹è¯•æ€§èƒ½æ•°æ®æ”¶é›† API"""
        params = {
            'platform': 'Android',
            'deviceid': 'test_device',
            'pkgname': 'com.test.app',
            'target': 'cpu'
        }
        
        response = requests.get(f'{self.base_url}/apm/collect', params=params)
        self.assertEqual(response.status_code, 200)
        
        data = response.json()
        self.assertIn('code', data)
        self.assertIn('data', data)
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
python -m pytest tests/test_performance_monitor.py

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/ --cov=solox --cov-report=html

# æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
open htmlcov/index.html
```

## ğŸ“š æ–‡æ¡£è´¡çŒ®

### 1. æ–‡æ¡£ç»“æ„

```
docs/
â”œâ”€â”€ README.md                # æ–‡æ¡£æ€»è§ˆ
â”œâ”€â”€ 01-é¡¹ç›®æ¦‚è¿°.md           # é¡¹ç›®ä»‹ç»
â”œâ”€â”€ 02-æŠ€æœ¯æ¶æ„.md           # æŠ€æœ¯æ¶æ„
â”œâ”€â”€ 03-å¿«é€Ÿå¯åŠ¨.md           # å¿«é€Ÿå¼€å§‹
â”œâ”€â”€ 04-å¼€å‘æŒ‡å—.md           # å¼€å‘æŒ‡å—
â”œâ”€â”€ 05-APIæ–‡æ¡£.md            # API æ–‡æ¡£
â”œâ”€â”€ 06-æ€§èƒ½ç›‘æ§.md           # æ€§èƒ½ç›‘æ§
â”œâ”€â”€ 07-éƒ¨ç½²æŒ‡å—.md           # éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ 08-æ•…éšœæ’é™¤.md           # æ•…éšœæ’é™¤
â””â”€â”€ 09-è´¡çŒ®æŒ‡å—.md           # è´¡çŒ®æŒ‡å—
```

### 2. æ–‡æ¡£è§„èŒƒ

- ä½¿ç”¨ Markdown æ ¼å¼
- åŒ…å«ä»£ç ç¤ºä¾‹
- æ·»åŠ é€‚å½“çš„å›¾è¡¨å’Œæˆªå›¾
- ä¿æŒå†…å®¹å‡†ç¡®å’Œæœ€æ–°
- ä½¿ç”¨æ¸…æ™°çš„æ ‡é¢˜ç»“æ„

### 3. API æ–‡æ¡£ç¤ºä¾‹

```markdown
## è·å– CPU ä½¿ç”¨ç‡

**æ¥å£åœ°å€**: `/apm/collect`

**è¯·æ±‚æ–¹å¼**: `GET`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| platform | string | æ˜¯ | å¹³å°ç±»å‹: `Android` æˆ– `iOS` |
| deviceid | string | æ˜¯ | è®¾å¤‡ ID |
| pkgname | string | æ˜¯ | åº”ç”¨åŒ…å |
| target | string | æ˜¯ | å›ºå®šå€¼: `cpu` |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl "http://localhost:50003/apm/collect?platform=Android&deviceid=ca6bd5a5&pkgname=com.example.app&target=cpu"
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "appCpuRate": 25.5,
    "systemCpuRate": 45.2
  }
}
```
```

## ğŸ› Bug æŠ¥å‘Š

### 1. æŠ¥å‘Šæ¨¡æ¿

```markdown
## Bug æè¿°
ç®€è¦æè¿°é‡åˆ°çš„é—®é¢˜

## å¤ç°æ­¥éª¤
1. æ‰§è¡Œæ­¥éª¤ 1
2. æ‰§è¡Œæ­¥éª¤ 2
3. çœ‹åˆ°é”™è¯¯

## é¢„æœŸè¡Œä¸º
æè¿°æ‚¨æœŸæœ›å‘ç”Ÿçš„æƒ…å†µ

## å®é™…è¡Œä¸º
æè¿°å®é™…å‘ç”Ÿçš„æƒ…å†µ

## ç¯å¢ƒä¿¡æ¯
- æ“ä½œç³»ç»Ÿ: [ä¾‹å¦‚ Ubuntu 20.04]
- Python ç‰ˆæœ¬: [ä¾‹å¦‚ 3.10.0]
- SoloX ç‰ˆæœ¬: [ä¾‹å¦‚ 2.9.3]
- è®¾å¤‡ç±»å‹: [ä¾‹å¦‚ Android 13]

## é”™è¯¯æ—¥å¿—
```
ç²˜è´´ç›¸å…³çš„é”™è¯¯æ—¥å¿—
```

## é™„åŠ ä¿¡æ¯
æ·»åŠ ä»»ä½•å…¶ä»–æœ‰åŠ©äºè§£å†³é—®é¢˜çš„ä¿¡æ¯
```

### 2. æäº¤ Bug

1. åœ¨ [GitHub Issues](https://github.com/smart-test-ti/SoloX/issues) åˆ›å»ºæ–° Issue
2. ä½¿ç”¨ Bug æŠ¥å‘Šæ¨¡æ¿
3. æ·»åŠ é€‚å½“çš„æ ‡ç­¾
4. æä¾›è¯¦ç»†çš„å¤ç°æ­¥éª¤

## âœ¨ åŠŸèƒ½è¯·æ±‚

### 1. è¯·æ±‚æ¨¡æ¿

```markdown
## åŠŸèƒ½æè¿°
ç®€è¦æè¿°æ‚¨å¸Œæœ›æ·»åŠ çš„åŠŸèƒ½

## ä½¿ç”¨åœºæ™¯
æè¿°è¿™ä¸ªåŠŸèƒ½çš„ä½¿ç”¨åœºæ™¯å’Œä»·å€¼

## è¯¦ç»†è®¾è®¡
è¯¦ç»†æè¿°åŠŸèƒ½çš„å®ç°æ–¹æ¡ˆ

## æ›¿ä»£æ–¹æ¡ˆ
æè¿°æ‚¨è€ƒè™‘è¿‡çš„å…¶ä»–è§£å†³æ–¹æ¡ˆ

## é™„åŠ ä¿¡æ¯
æ·»åŠ ä»»ä½•å…¶ä»–ç›¸å…³ä¿¡æ¯
```

### 2. åŠŸèƒ½å¼€å‘

1. åˆ›å»ºåŠŸèƒ½è¯·æ±‚ Issue
2. ç­‰å¾…ç»´æŠ¤è€…ç¡®è®¤
3. Fork é¡¹ç›®å¹¶åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
4. å®ç°åŠŸèƒ½å¹¶æ·»åŠ æµ‹è¯•
5. æäº¤ Pull Request

## ğŸ”„ Pull Request æµç¨‹

### 1. PR æ£€æŸ¥æ¸…å•

- [ ] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒ
- [ ] æ·»åŠ äº†é€‚å½“çš„æµ‹è¯•
- [ ] æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] æäº¤ä¿¡æ¯ç¬¦åˆè§„èŒƒ
- [ ] æ²¡æœ‰åˆå¹¶å†²çª

### 2. PR æ¨¡æ¿

```markdown
## å˜æ›´æè¿°
ç®€è¦æè¿°è¿™ä¸ª PR çš„å˜æ›´å†…å®¹

## å˜æ›´ç±»å‹
- [ ] Bug ä¿®å¤
- [ ] æ–°åŠŸèƒ½
- [ ] æ–‡æ¡£æ›´æ–°
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ä»£ç é‡æ„

## æµ‹è¯•
- [ ] æ·»åŠ äº†æ–°çš„æµ‹è¯•
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•é€šè¿‡

## ç›¸å…³ Issue
å…³é—­ #issue_number

## æ£€æŸ¥æ¸…å•
- [ ] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒ
- [ ] æ·»åŠ äº†é€‚å½“çš„æ–‡æ¡£
- [ ] æ²¡æœ‰ç ´åæ€§å˜æ›´
```

### 3. ä»£ç å®¡æŸ¥

1. ç»´æŠ¤è€…ä¼šå®¡æŸ¥æ‚¨çš„ä»£ç 
2. æ ¹æ®åé¦ˆè¿›è¡Œä¿®æ”¹
3. é€šè¿‡å®¡æŸ¥ååˆå¹¶åˆ°ä¸»åˆ†æ”¯

## ğŸ† è´¡çŒ®è€…è®¤å¯

### 1. è´¡çŒ®è€…åˆ—è¡¨

æˆ‘ä»¬ä¼šåœ¨é¡¹ç›®ä¸­ç»´æŠ¤è´¡çŒ®è€…åˆ—è¡¨ï¼Œæ„Ÿè°¢æ¯ä¸€ä½è´¡çŒ®è€…çš„ä»˜å‡ºã€‚

### 2. è´¡çŒ®ç»Ÿè®¡

- ä»£ç è´¡çŒ®
- æ–‡æ¡£è´¡çŒ®
- Bug æŠ¥å‘Š
- åŠŸèƒ½å»ºè®®
- ç¤¾åŒºæ”¯æŒ

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub Issues**: https://github.com/smart-test-ti/SoloX/issues
- **é¡¹ç›®ä¸»é¡µ**: https://github.com/smart-test-ti/SoloX
- **é‚®ç®±**: rafacheninc@gmail.com

## ğŸ“„ è®¸å¯è¯

é€šè¿‡è´¡çŒ®ä»£ç ï¼Œæ‚¨åŒæ„æ‚¨çš„è´¡çŒ®å°†åœ¨ [MIT è®¸å¯è¯](../LICENSE) ä¸‹å‘å¸ƒã€‚

---

æ„Ÿè°¢æ‚¨å¯¹ SoloX é¡¹ç›®çš„è´¡çŒ®ï¼ğŸ‰
